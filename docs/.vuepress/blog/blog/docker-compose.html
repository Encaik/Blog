<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker-compose使用 | &lt;Encaik学前端/&gt;</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="manifest" href="/json/manifest.json">
    <link rel="apple-touch-icon" href="/img/favicon.ico">
    <link rel="mask-icon" href="/img/favicon.ico" color="#fff">
    <meta name="description" content="<Encaik学前端/>">
    <meta name="theme-color" content="#fff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/img/favicon.ico">
    <meta name="msapplication-TileColor" content="#fff">
    <link rel="preload" href="/assets/css/0.styles.dc595e24.css" as="style"><link rel="preload" href="/assets/js/app.d56afe1d.js" as="script"><link rel="preload" href="/assets/js/3.89568fe3.js" as="script"><link rel="preload" href="/assets/js/2.590cb2e6.js" as="script"><link rel="preload" href="/assets/js/13.ea21ee83.js" as="script"><link rel="preload" href="/assets/js/4.8eb3e90a.js" as="script"><link rel="prefetch" href="/assets/js/10.690acdac.js"><link rel="prefetch" href="/assets/js/11.ed7ff540.js"><link rel="prefetch" href="/assets/js/12.994f1f21.js"><link rel="prefetch" href="/assets/js/14.a5501e55.js"><link rel="prefetch" href="/assets/js/15.5c53807d.js"><link rel="prefetch" href="/assets/js/16.a6f4d5c4.js"><link rel="prefetch" href="/assets/js/17.b557a170.js"><link rel="prefetch" href="/assets/js/18.d9c879b2.js"><link rel="prefetch" href="/assets/js/19.d840861c.js"><link rel="prefetch" href="/assets/js/20.5466fe38.js"><link rel="prefetch" href="/assets/js/21.a4c287db.js"><link rel="prefetch" href="/assets/js/22.6eac7f3b.js"><link rel="prefetch" href="/assets/js/23.73cc089f.js"><link rel="prefetch" href="/assets/js/24.5a371d4a.js"><link rel="prefetch" href="/assets/js/25.e4a08eb5.js"><link rel="prefetch" href="/assets/js/26.b05909f2.js"><link rel="prefetch" href="/assets/js/27.2f253b2e.js"><link rel="prefetch" href="/assets/js/28.97e715cc.js"><link rel="prefetch" href="/assets/js/29.e69663cc.js"><link rel="prefetch" href="/assets/js/30.16f07b91.js"><link rel="prefetch" href="/assets/js/31.9842495b.js"><link rel="prefetch" href="/assets/js/32.b5be6718.js"><link rel="prefetch" href="/assets/js/33.371bb827.js"><link rel="prefetch" href="/assets/js/34.1cc9bb3c.js"><link rel="prefetch" href="/assets/js/35.ec2c2b44.js"><link rel="prefetch" href="/assets/js/36.33beb24a.js"><link rel="prefetch" href="/assets/js/37.d8f0998d.js"><link rel="prefetch" href="/assets/js/38.60206009.js"><link rel="prefetch" href="/assets/js/39.6ec10152.js"><link rel="prefetch" href="/assets/js/40.0de34a8f.js"><link rel="prefetch" href="/assets/js/41.2dcd7f0b.js"><link rel="prefetch" href="/assets/js/42.11d95687.js"><link rel="prefetch" href="/assets/js/43.1109556c.js"><link rel="prefetch" href="/assets/js/44.4d76efd3.js"><link rel="prefetch" href="/assets/js/45.efd01b7e.js"><link rel="prefetch" href="/assets/js/46.73b33028.js"><link rel="prefetch" href="/assets/js/47.fd519161.js"><link rel="prefetch" href="/assets/js/48.b1b28e66.js"><link rel="prefetch" href="/assets/js/49.86a4671e.js"><link rel="prefetch" href="/assets/js/5.8ff02f63.js"><link rel="prefetch" href="/assets/js/50.b4875615.js"><link rel="prefetch" href="/assets/js/51.be1e8109.js"><link rel="prefetch" href="/assets/js/52.f9e3133f.js"><link rel="prefetch" href="/assets/js/53.183c44ad.js"><link rel="prefetch" href="/assets/js/54.20da8e29.js"><link rel="prefetch" href="/assets/js/55.110a713f.js"><link rel="prefetch" href="/assets/js/56.52be78b1.js"><link rel="prefetch" href="/assets/js/57.6e2b18dc.js"><link rel="prefetch" href="/assets/js/58.62f019a4.js"><link rel="prefetch" href="/assets/js/59.9164192a.js"><link rel="prefetch" href="/assets/js/6.e9fe7882.js"><link rel="prefetch" href="/assets/js/60.717deb85.js"><link rel="prefetch" href="/assets/js/61.adad4150.js"><link rel="prefetch" href="/assets/js/62.dc4b38fa.js"><link rel="prefetch" href="/assets/js/63.0c56f3e2.js"><link rel="prefetch" href="/assets/js/64.2e44886d.js"><link rel="prefetch" href="/assets/js/65.86bde0c8.js"><link rel="prefetch" href="/assets/js/66.33bf0fa4.js"><link rel="prefetch" href="/assets/js/67.616cb1bc.js"><link rel="prefetch" href="/assets/js/68.a8d9157f.js"><link rel="prefetch" href="/assets/js/69.719600a4.js"><link rel="prefetch" href="/assets/js/7.e5e5ff12.js"><link rel="prefetch" href="/assets/js/70.401b5c15.js"><link rel="prefetch" href="/assets/js/8.46fec6ec.js"><link rel="prefetch" href="/assets/js/9.ad4433e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dc595e24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">&lt;Encaik学前端/&gt;</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">📓学习日志</a></div><div class="nav-item"><a href="/note/" class="nav-link">📃笔记摘录</a></div><div class="nav-item"><a href="/leecode/" class="nav-link">📰力扣记录</a></div><div class="nav-item"><a href="/repo/" class="nav-link">📦项目总结</a></div><div class="nav-item"><a href="/road/" class="nav-link">📖知识总览</a></div><div class="nav-item"><a href="https://github.com/Encaik" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/encaik" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://encaik.gitee.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  [国内镜像]
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">📓学习日志</a></div><div class="nav-item"><a href="/note/" class="nav-link">📃笔记摘录</a></div><div class="nav-item"><a href="/leecode/" class="nav-link">📰力扣记录</a></div><div class="nav-item"><a href="/repo/" class="nav-link">📦项目总结</a></div><div class="nav-item"><a href="/road/" class="nav-link">📖知识总览</a></div><div class="nav-item"><a href="https://github.com/Encaik" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitee.com/encaik" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://encaik.gitee.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  [国内镜像]
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/" aria-current="page" class="sidebar-link">前端工程化项目构建流程及基本结构</a></li><li><a href="/blog/puppeteer.html" class="sidebar-link">初步学习如何使用 puppeteer 操控无头浏览器</a></li><li><a href="/blog/springboot.html" class="sidebar-link">学习 Springboot 做后端</a></li><li><a href="/blog/nodespider.html" class="sidebar-link">使用 node.js 完成爬虫操作</a></li><li><a href="/blog/nodecli.html" class="sidebar-link">自己做一个带 cli 的 npm 包发布</a></li><li><a href="/blog/webpack.html" class="sidebar-link">分析 webpack 源码，理解原理</a></li><li><a href="/blog/echarts.html" class="sidebar-link">Echarts 的使用及配置项对照</a></li><li><a href="/blog/csspre.html" class="sidebar-link">CSS 预处理器-Sass，Less，Stylus 对比</a></li><li><a href="/blog/socketio.html" class="sidebar-link">使用 socket.io 做一个在线聊天室</a></li><li><a href="/blog/taro.html" class="sidebar-link">Taro 多端统一小程序框架体验</a></li><li><a href="/blog/deno.html" class="sidebar-link">初探 Deno，学习用法</a></li><li><a href="/blog/ast.html" class="sidebar-link">从 estree 和 babel 中学习 js 的 AST</a></li><li><a href="/blog/canvas.html" class="sidebar-link">学习canvas制作一个代码美化截图页面</a></li><li><a href="/blog/console.html" class="sidebar-link">学习使用花里胡哨的Console</a></li><li><a href="/blog/performance.html" class="sidebar-link">学习前端性能监控PerformanceApi</a></li><li><a href="/blog/g6.html" class="sidebar-link">学习 AntV G6 图可视化引擎</a></li><li><a href="/blog/map.html" class="sidebar-link">地图 api 及 Cesium.js 库总结</a></li><li><a href="/blog/golang.html" class="sidebar-link">学习使用Golang</a></li><li><a href="/blog/angular.html" class="sidebar-link">学习使用Angular9</a></li><li><a href="/blog/vue3.html" class="sidebar-link">从头开始学习Vue3源码</a></li><li><a href="/blog/vue2.html" class="sidebar-link">从头开始学习Vue2源码</a></li><li><a href="/blog/tensorflow.html" class="sidebar-link">学习使用 Tensorflow.js 机器学习</a></li><li><a href="/blog/koa2-learn.html" class="sidebar-link">Koa2基本学习</a></li><li><a href="/blog/docker-project.html" class="sidebar-link">docker-compose部署流程</a></li><li><a href="/blog/docker-compose.html" aria-current="page" class="active sidebar-link">Docker-compose使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#pip安装（推荐）" class="sidebar-link">pip安装（推荐）</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#二进制安装" class="sidebar-link">二进制安装</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#docker-compose-yml" class="sidebar-link">docker-compose.yml</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#image" class="sidebar-link">image</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#build" class="sidebar-link">build</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#command" class="sidebar-link">command</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#links" class="sidebar-link">links</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#external-links" class="sidebar-link">external_links</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#ports" class="sidebar-link">ports</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#expose" class="sidebar-link">expose</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#volumes" class="sidebar-link">volumes</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#volumes-from" class="sidebar-link">volumes_from</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#environment" class="sidebar-link">environment</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#env-file" class="sidebar-link">env_file</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#extends" class="sidebar-link">extends</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#net" class="sidebar-link">net</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#pid" class="sidebar-link">pid</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#dns" class="sidebar-link">dns</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#cap-add-cap-drop" class="sidebar-link">capadd, capdrop</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#dns-search" class="sidebar-link">dns_search</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#working-dir-entrypoint-user-hostname-domainname-mem-limit-privileged-restart-stdin-open-tty-cpu-shares" class="sidebar-link">workingdir, entrypoint, user, hostname, domainname, memlimit, privileged, restart, stdinopen, tty, cpushares</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#docker-compose命令" class="sidebar-link">docker-compose命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#build-2" class="sidebar-link">build</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#help" class="sidebar-link">help</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#kill" class="sidebar-link">kill</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#logs" class="sidebar-link">logs</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#port" class="sidebar-link">port</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#ps" class="sidebar-link">ps</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#pull" class="sidebar-link">pull</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#rm" class="sidebar-link">rm</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#run" class="sidebar-link">run</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#scale" class="sidebar-link">scale</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#start" class="sidebar-link">start</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#stop" class="sidebar-link">stop</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#up" class="sidebar-link">up</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#环境变量" class="sidebar-link">环境变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#compose-project-name" class="sidebar-link">COMPOSEPROJECTNAME</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#compose-file" class="sidebar-link">COMPOSE_FILE</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#docker-host" class="sidebar-link">DOCKER_HOST</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#docker-tls-verify" class="sidebar-link">DOCKERTLSVERIFY</a></li><li class="sidebar-sub-header"><a href="/blog/docker-compose.html#docker-cert-path" class="sidebar-link">DOCKERCERTPATH</a></li></ul></li></ul></li><li><a href="/blog/docker.html" class="sidebar-link">Docker 使用</a></li><li><a href="/blog/flutter.html" class="sidebar-link">学习使用Flutter进行移动端开发</a></li><li><a href="/blog/react-native.html" class="sidebar-link">React Native学习-创建项目</a></li><li><a href="/blog/react.html" class="sidebar-link">React学习-创建项目</a></li><li><a href="/blog/vuetestutils2.html" class="sidebar-link">vue-test-utils学习-用nightwatch进行e2e测试</a></li><li><a href="/blog/vuetestutils.html" class="sidebar-link">vue-test-utils学习-用jest进行单元测试</a></li><li><a href="/blog/tsspider.html" class="sidebar-link">Typescr学习-实现基础爬虫</a></li><li><a href="/blog/egg.html" class="sidebar-link">学习使用Egg.js搭建后端</a></li><li><a href="/blog/tonejs.html" class="sidebar-link">学习使用Tone.js制作网页版乐器</a></li><li><a href="/blog/electron.html" class="sidebar-link">学习 Electron 框架制作桌面端应用</a></li><li><a href="/blog/http.html" class="sidebar-link">前端请求发展及使用</a></li><li><a href="/blog/git.html" class="sidebar-link">Git 语法及使用</a></li><li><a href="/blog/vuepress.html" class="sidebar-link">Vuepress搭建博客</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker-compose使用"><a href="#docker-compose使用" class="header-anchor">#</a> Docker-compose使用</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <h3 id="pip安装（推荐）"><a href="#pip安装（推荐）" class="header-anchor">#</a> pip安装（推荐）</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> pip <span class="token function">install</span> -U docker-compose
</code></pre></div><p>然后通过bash补全命令。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.2.0/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre></div><h3 id="二进制安装"><a href="#二进制安装" class="header-anchor">#</a> 二进制安装</h3> <p>二进制安装包可以直接在github上找到，下载后解压到执行目录即可。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.2.0/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre></div><h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <p>服务（service）：一个应用容器，实际上可以运行多个相同镜像的实例。</p> <p>项目(project)：由一组关联的应用容器组成的一个完整业务单元。</p> <p>可见，一个项目可以由多个服务（容器）关联而成，Compose 面向项目进行管理。</p> <h2 id="docker-compose-yml"><a href="#docker-compose-yml" class="header-anchor">#</a> docker-compose.yml</h2> <p>默认的模板文件是 docker-compose.yml，其中定义的每个服务都必须通过 image 指令指定镜像或 build 指令（需要 Dockerfile）来自动构建。</p> <p>其它大部分指令都跟 docker run 中的类似。</p> <p>如果使用 build 指令，在 Dockerfile 中设置的选项(例如：CMD, EXPOSE, VOLUME, ENV 等) 将会自动被获取，无需在 docker-compose.yml 中再次设置。</p> <h3 id="image"><a href="#image" class="header-anchor">#</a> image</h3> <p>指定为镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉去这个镜像。</p> <p>例如：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>image: ubuntu
image: orchardup/postgresql
image: a4bc65fd
</code></pre></div><h3 id="build"><a href="#build" class="header-anchor">#</a> build</h3> <p>指定 Dockerfile 所在文件夹的路径。 Compose 将会利用它自动构建这个镜像，然后使用这个镜像。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>build: /path/to/build/dir
</code></pre></div><h3 id="command"><a href="#command" class="header-anchor">#</a> command</h3> <p>覆盖容器启动后默认执行的命令。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>command: bundle <span class="token builtin class-name">exec</span> thin -p <span class="token number">3000</span>
</code></pre></div><h3 id="links"><a href="#links" class="header-anchor">#</a> links</h3> <p>链接到其它服务中的容器。使用服务名称（同时作为别名）或服务名称：服务别名 （SERVICE:ALIAS） 格式都可以。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>links:
 - db
 - db:database
 - redis
</code></pre></div><p>使用的别名将会自动在服务容器中的 /etc/hosts 里创建。例如：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token number">172.17</span>.2.186  db
<span class="token number">172.17</span>.2.186  database
<span class="token number">172.17</span>.2.187  redis
</code></pre></div><p>相应的环境变量也将被创建。</p> <h3 id="external-links"><a href="#external-links" class="header-anchor">#</a> external_links</h3> <p>链接到 docker-compose.yml 外部的容器，甚至 并非 Compose 管理的容器。参数格式跟 links 类似。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>external_links:
 - redis_1
 - project_db_1:mysql
 - project_db_1:postgresql
</code></pre></div><h3 id="ports"><a href="#ports" class="header-anchor">#</a> ports</h3> <p>暴露端口信息。</p> <p>使用宿主：容器 （HOST:CONTAINER）格式或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>ports:
 - <span class="token string">&quot;3000&quot;</span>
 - <span class="token string">&quot;8000:8000&quot;</span>
 - <span class="token string">&quot;49100:22&quot;</span>
 - <span class="token string">&quot;127.0.0.1:8001:8001&quot;</span>
</code></pre></div><p>注：当使用 HOST:CONTAINER 格式来映射端口时，如果你使用的容器端口小于 60 你可能会得到错误得结果，因为 YAML 将会解析 xx:yy 这种数字格式为 60 进制。所以建议采用字符串格式。</p> <h3 id="expose"><a href="#expose" class="header-anchor">#</a> expose</h3> <p>暴露端口，但不映射到宿主机，只被连接的服务访问。</p> <p>仅可以指定内部端口为参数</p> <div class="language-sh extra-class"><pre class="language-sh"><code>expose:
 - <span class="token string">&quot;3000&quot;</span>
 - <span class="token string">&quot;8000&quot;</span>
</code></pre></div><h3 id="volumes"><a href="#volumes" class="header-anchor">#</a> volumes</h3> <p>卷挂载路径设置。可以设置宿主机路径 （HOST:CONTAINER） 或加上访问模式 （HOST:CONTAINER:ro）。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>volumes:
 - /var/lib/mysql
 - cache/:/tmp/cache
 - ~/configs:/etc/configs/:ro
</code></pre></div><h3 id="volumes-from"><a href="#volumes-from" class="header-anchor">#</a> volumes_from</h3> <p>从另一个服务或容器挂载它的所有卷。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>volumes_from:
 - service_name
 - container_name
</code></pre></div><h3 id="environment"><a href="#environment" class="header-anchor">#</a> environment</h3> <p>设置环境变量。你可以使用数组或字典两种格式。</p> <p>只给定名称的变量会自动获取它在 Compose 主机上的值，可以用来防止泄露不必要的数据。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>environment:
  RACK_ENV: development
  SESSION_SECRET:

environment:
  - <span class="token assign-left variable">RACK_ENV</span><span class="token operator">=</span>development
  - SESSION_SECRET
</code></pre></div><h3 id="env-file"><a href="#env-file" class="header-anchor">#</a> env_file</h3> <p>从文件中获取环境变量，可以为单独的文件路径或列表。</p> <p>如果通过 docker-compose -f FILE 指定了模板文件，则 env_file 中路径会基于模板文件路径。</p> <p>如果有变量名称与 environment 指令冲突，则以后者为准。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre></div><p>环境变量文件中每一行必须符合格式，支持 # 开头的注释行。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># common.env: Set Rails/Rack environment</span>
<span class="token assign-left variable">RACK_ENV</span><span class="token operator">=</span>development
</code></pre></div><h3 id="extends"><a href="#extends" class="header-anchor">#</a> extends</h3> <p>基于已有的服务进行扩展。例如我们已经有了一个 webapp 服务，模板文件为 common.yml。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># common.yml</span>
webapp:
  build: ./webapp
  environment:
    - <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>false
    - <span class="token assign-left variable">SEND_EMAILS</span><span class="token operator">=</span>false
</code></pre></div><p>编写一个新的 development.yml 文件，使用 common.yml 中的 webapp 服务进行扩展。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># development.yml</span>
web:
  extends:
    file: common.yml
    service: webapp
  ports:
    - <span class="token string">&quot;8000:8000&quot;</span>
  links:
    - db
  environment:
    - <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>true
db:
  image: postgres
</code></pre></div><p>后者会自动继承 common.yml 中的 webapp 服务及相关环节变量。</p> <h3 id="net"><a href="#net" class="header-anchor">#</a> net</h3> <p>设置网络模式。使用和 docker client 的 --net 参数一样的值。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>net: <span class="token string">&quot;bridge&quot;</span>
net: <span class="token string">&quot;none&quot;</span>
net: <span class="token string">&quot;container:[name or id]&quot;</span>
net: <span class="token string">&quot;host&quot;</span>
</code></pre></div><h3 id="pid"><a href="#pid" class="header-anchor">#</a> pid</h3> <p>跟主机系统共享进程命名空间。打开该选项的容器可以相互通过进程 ID 来访问和操作。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>pid: <span class="token string">&quot;host&quot;</span>
</code></pre></div><h3 id="dns"><a href="#dns" class="header-anchor">#</a> dns</h3> <p>配置 DNS 服务器。可以是一个值，也可以是一个列表。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>dns: <span class="token number">8.8</span>.8.8
dns:
  - <span class="token number">8.8</span>.8.8
  - <span class="token number">9.9</span>.9.9
</code></pre></div><h3 id="cap-add-cap-drop"><a href="#cap-add-cap-drop" class="header-anchor">#</a> cap_add, cap_drop</h3> <p>添加或放弃容器的 Linux 能力（Capabiliity）。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>cap_add:
  - ALL

cap_drop:
  - NET_ADMIN
  - SYS_ADMIN
</code></pre></div><h3 id="dns-search"><a href="#dns-search" class="header-anchor">#</a> dns_search</h3> <p>配置 DNS 搜索域。可以是一个值，也可以是一个列表。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>dns_search: example.com
dns_search:
  - domain1.example.com
  - domain2.example.com
</code></pre></div><h3 id="working-dir-entrypoint-user-hostname-domainname-mem-limit-privileged-restart-stdin-open-tty-cpu-shares"><a href="#working-dir-entrypoint-user-hostname-domainname-mem-limit-privileged-restart-stdin-open-tty-cpu-shares" class="header-anchor">#</a> working_dir, entrypoint, user, hostname, domainname, mem_limit, privileged, restart, stdin_open, tty, cpu_shares</h3> <p>这些都是和 docker run 支持的选项类似。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>cpu_shares: <span class="token number">73</span>

working_dir: /code
entrypoint: /code/entrypoint.sh
user: postgresql

hostname: foo
domainname: foo.com

mem_limit: <span class="token number">1000000000</span>
privileged: <span class="token boolean">true</span>

restart: always

stdin_open: <span class="token boolean">true</span>
tty: <span class="token boolean">true</span>
</code></pre></div><h2 id="docker-compose命令"><a href="#docker-compose命令" class="header-anchor">#</a> docker-compose命令</h2> <h3 id="build-2"><a href="#build-2" class="header-anchor">#</a> build</h3> <p>构建或重新构建服务。</p> <p>服务一旦构建后，将会带上一个标记名，例如 web_db。</p> <p>可以随时在项目目录下运行 docker-compose build 来重新构建服务。</p> <h3 id="help"><a href="#help" class="header-anchor">#</a> help</h3> <p>获得一个命令的帮助。</p> <h3 id="kill"><a href="#kill" class="header-anchor">#</a> kill</h3> <p>通过发送 SIGKILL 信号来强制停止服务容器。支持通过参数来指定发送的信号，例如</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker-compose <span class="token function">kill</span> -s SIGINT
</code></pre></div><h3 id="logs"><a href="#logs" class="header-anchor">#</a> logs</h3> <p>查看服务的输出。</p> <h3 id="port"><a href="#port" class="header-anchor">#</a> port</h3> <p>打印绑定的公共端口。</p> <h3 id="ps"><a href="#ps" class="header-anchor">#</a> ps</h3> <p>列出所有容器。</p> <h3 id="pull"><a href="#pull" class="header-anchor">#</a> pull</h3> <p>拉取服务镜像。</p> <h3 id="rm"><a href="#rm" class="header-anchor">#</a> rm</h3> <p>删除停止的服务容器。</p> <h3 id="run"><a href="#run" class="header-anchor">#</a> run</h3> <p>在一个服务上执行一个命令。</p> <p>例如：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker-compose run ubuntu <span class="token function">ping</span> docker.com
</code></pre></div><p>将会启动一个 ubuntu 服务，执行 ping docker.com 命令。</p> <p>默认情况下，所有关联的服务将会自动被启动，除非这些服务已经在运行中。</p> <p>该命令类似启动容器后运行指定的命令，相关卷、链接等等都将会按照期望创建。</p> <p>两个不同点：</p> <p>给定命令将会覆盖原有的自动运行命令；
不会自动创建端口，以避免冲突。
如果不希望自动启动关联的容器，可以使用 --no-deps 选项，例如</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker-compose run --no-deps web python manage.py shell
</code></pre></div><p>将不会启动 web 容器所关联的其它容器。</p> <h3 id="scale"><a href="#scale" class="header-anchor">#</a> scale</h3> <p>设置同一个服务运行的容器个数。</p> <p>通过 service=num 的参数来设置数量。例如：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker-compose scale <span class="token assign-left variable">web</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">worker</span><span class="token operator">=</span><span class="token number">3</span>
</code></pre></div><h3 id="start"><a href="#start" class="header-anchor">#</a> start</h3> <p>启动一个已经存在的服务容器。</p> <h3 id="stop"><a href="#stop" class="header-anchor">#</a> stop</h3> <p>停止一个已经运行的容器，但不删除它。通过 docker-compose start 可以再次启动这些容器。</p> <h3 id="up"><a href="#up" class="header-anchor">#</a> up</h3> <p>构建，（重新）创建，启动，链接一个服务相关的容器。</p> <p>链接的服务都将会启动，除非他们已经运行。</p> <p>默认情况， docker-compose up 将会整合所有容器的输出，并且退出时，所有容器将会停止。</p> <p>如果使用 docker-compose up -d ，将会在后台启动并运行所有的容器。</p> <p>默认情况，如果该服务的容器已经存在， docker-compose up 将会停止并尝试重新创建他们（保持使用volumes-from 挂载的卷），以保证 docker-compose.yml 的修改生效。如果你不想容器被停止并重新创建，可以使用 docker-compose up --no-recreate。如果需要的话，这样将会启动已经停止的容器。</p> <h2 id="环境变量"><a href="#环境变量" class="header-anchor">#</a> 环境变量</h2> <p>环境变量可以用来配置 Compose 的行为。</p> <p>以DOCKER_开头的变量和用来配置 Docker 命令行客户端的使用一样。如果使用 boot2docker , $(boot2docker shellinit) 将会设置它们为正确的值。</p> <h3 id="compose-project-name"><a href="#compose-project-name" class="header-anchor">#</a> COMPOSE_PROJECT_NAME</h3> <p>设置通过 Compose 启动的每一个容器前添加的项目名称，默认是当前工作目录的名字。</p> <h3 id="compose-file"><a href="#compose-file" class="header-anchor">#</a> COMPOSE_FILE</h3> <p>设置要使用的 docker-compose.yml 的路径。默认路径是当前工作目录。</p> <h3 id="docker-host"><a href="#docker-host" class="header-anchor">#</a> DOCKER_HOST</h3> <p>设置 Docker daemon 的地址。默认使用 unix:///var/run/docker.sock，与 Docker 客户端采用的默认值一致。</p> <h3 id="docker-tls-verify"><a href="#docker-tls-verify" class="header-anchor">#</a> DOCKER_TLS_VERIFY</h3> <p>如果设置不为空，则与 Docker daemon 交互通过 TLS 进行。</p> <h3 id="docker-cert-path"><a href="#docker-cert-path" class="header-anchor">#</a> DOCKER_CERT_PATH</h3> <p>配置 TLS 通信所需要的验证（ca.pem、cert.pem 和 key.pem）文件的路径，默认是 ~/.docker 。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">发布日期:</span> <span class="time">12/23/2019, 10:50:54 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/docker-project.html" class="prev">
        docker-compose部署流程
      </a></span> <span class="next"><a href="/blog/docker.html">
        Docker 使用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.d56afe1d.js" defer></script><script src="/assets/js/3.89568fe3.js" defer></script><script src="/assets/js/2.590cb2e6.js" defer></script><script src="/assets/js/13.ea21ee83.js" defer></script><script src="/assets/js/4.8eb3e90a.js" defer></script>
  </body>
</html>
